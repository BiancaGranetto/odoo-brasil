<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <report file="br_nfse.main_template_br_nfse_danfe"
        id="report_br_nfse_danfe" model="invoice.eletronic"
        name="br_nfse.main_template_br_nfse_danfe"
        report_type="qweb-pdf" string="Impressão de Danfe"/>
    <record id="paperformat_br_nfse_danfse" model="report.paperformat">
        <field name="name">Danfse</field>
        <field eval="True" name="default"/>
        <field name="orientation">Portrait</field>
        <field name="margin_top">3</field>
        <field name="margin_bottom">3</field>
        <field name="margin_left">3</field>
        <field name="margin_right">3</field>
        <field eval="False" name="header_line"/>
        <field name="header_spacing">3</field>
    </record>
    <record id="report_br_nfse_danfe" model="ir.actions.report.xml">
        <field name="paperformat_id" ref="paperformat_br_nfse_danfse"/>
        <field name="name">Impressao de Danfe Paulistana</field>
    </record>
    <template id="danfse_report_template">
        <style type="text/css">
            .col-xs-1, .col-xs-2,
            .col-xs-3,.col-xs-4,.col-xs-5, .col-xs-6, .col-xs-7,
            .col-xs-8,
            .col-xs-9, .col-xs-10, .col-xs-11, .col-xs-12 {
                padding:0px;
            }
            td, th { padding: 0 4px; }
        </style>
        <div class="page">
            <div class="row" style="border: 1px solid black;">
                <div class="col-xs-2">
                    <img alt="Logo Prefeitura Campinas"
                        src="/br_nfse/static/src/img/prefeitura-sp.gif" style="max-height:80px; margin-top:4px; margin-left:10px;"/>
                </div>
                <div class="col-xs-8" style="padding:0px;text-align:center;font-size:18px;">
                    Prefeitura do Município de São Paulo
                    <br/>
                    Secretaria Municipal de Finanças
                    <br/>
                    <t t-if="doc.state != 'done'">
                        <strong style="font-size:20px;">RECIBO PROVISÓRIO DE SERVIÇOS - RPS
                        </strong>
                    </t>
                    <t t-if="doc.state == 'done'">
                        <strong style="font-size:20px;">NOTA FISCAL ELETRÔNICA DE SERVIÇOS - NFSe</strong>
                        <br/>
                        RPS Nº <span
                            t-field="doc.numero"/> Série API, emitido em <span t-field="doc.data_emissao"/>
                    </t>
                </div>
                <div class="col-xs-2" style="padding:0px;">
                    <div style="border: 1px solid black; padding: 2px;">
                        <t t-if="doc.state == 'done'">
                            <span style="font-size:9px;">Número NFSe</span>
                            <br/>
                            <strong t-field="doc.numero_nfse"/>
                        </t>
                        <t t-if="doc.state != 'done'">
                            <span style="font-size:9px;">Número RPS</span>
                            <br/>
                            <strong t-field="doc.numero"/>
                        </t>
                    </div>
                    <div style="border: 1px solid black; padding: 2px;">
                        <span style="font-size:9px;">Data de Emissão</span>
                        <br/>
                        <strong t-field="doc.data_emissao"/>
                    </div>
                    <t t-if="doc.state == 'done'">
                        <div style="border: 1px solid black; padding: 2px;">
                            <span style="font-size:8px;">Código de verificação</span>
                            <br/>
                            <strong t-field="doc.verify_code"/>
                        </div>
                    </t>
                </div>
            </div>
            <div class="row" style="border: 1px solid black; padding: 0 0 5px 5px;">
                <div class="col-xs-1">
                    <img style="height:65px;margin-top:15px;" t-att-src="'data:image/png;base64,%s' % doc.company_id.logo"/>
                    <br/>
                </div>
                <div class="col-xs-11">
                    <div class="col-xs-12" style="text-align:center;">
                        <strong>PRESTADOR DE SERVIÇOS</strong>
                    </div>
                    <div
                            class="col-xs-12">
                        Nome/Razão Social:
                        <strong t-field="doc.company_id.partner_id.legal_name"/>
                    </div>
                    <div
                            class="col-xs-8">
                        CNPJ:
                        <strong t-field="doc.company_id.partner_id.cnpj_cpf"/>
                    </div>
                    <div
                            class="col-xs-4">
                        Inscrição Municipal:
                        <strong t-field="doc.company_id.partner_id.inscr_mun"/>
                    </div>
                    <div
                            class="col-xs-12">
                        Endereço:
                        <strong t-field="doc.company_id.partner_id.street"/>
                        <strong t-field="doc.company_id.partner_id.number"/>
                        <strong t-field="doc.company_id.partner_id.district"/>
                    </div>
                    <div
                            class="col-xs-6">
                        Município:
                        <strong t-field="doc.company_id.partner_id.city_id"/>
                    </div>
                    <div
                            class="col-xs-6">
                        UF:
                        <strong t-field="doc.company_id.partner_id.state_id"/>
                    </div>
                </div>
            </div>
            <div class="row" style="border: 1px solid black;padding: 0 0 5px 5px;">
                <div class="col-xs-12" style="text-align:center;">
                    <strong>TOMADOR DE SERVIÇOS</strong>
                </div>
                <div
                        class="col-xs-12">
                    Nome/Razão Social:
                    <strong t-field="doc.commercial_partner_id.legal_name"/>
                </div>
                <div
                        class="col-xs-8">
                    CNPJ:
                    <strong t-field="doc.commercial_partner_id.cnpj_cpf"/>
                </div>
                <div
                        class="col-xs-4">
                    Inscrição Municipal:
                    <strong t-field="doc.commercial_partner_id.inscr_mun"/>
                </div>
                <div
                        class="col-xs-12">
                    Endereço:
                    <strong t-field="doc.commercial_partner_id.street"/>
                    <strong t-field="doc.commercial_partner_id.number"/>
                    <strong t-field="doc.commercial_partner_id.district"/>
                </div>
                <div
                        class="col-xs-4">
                    Município:
                    <strong t-field="doc.commercial_partner_id.city_id"/>
                </div>
                <div
                        class="col-xs-2">
                    UF:
                    <strong t-field="doc.commercial_partner_id.state_id"/>
                </div>
                <div
                        class="col-xs-6">
                    E-mail:
                    <strong t-field="doc.partner_id.email"/>
                </div>
            </div>
            <div class="row" style="border: 1px solid black;padding: 0 0 5px 5px;">
                <div class="col-xs-12" style="text-align:center;">
                    <strong>INTERMEDIÁRIO DE SERVIÇOS</strong>
                    <br/>
                </div>
                <div class="col-xs-4">
                    CPF/CNPJ:
                    <strong> ---- </strong>
                </div>
                <div class="col-xs-8">
                    Nome/Razão Social:
                    <strong> ---- </strong>
                </div>
            </div>
            <div class="row" style="border: 1px solid black;padding: 0 0 5px 5px; min-height:350px;">
                <div class="col-xs-12" style="text-align:center;">
                    <strong>DISCRIMINAÇÃO DOS SERVIÇOS</strong>
                </div>
                <div class="col-xs-12">
                    <br/>
                    <t t-as="line" t-foreach="doc.eletronic_item_ids">
                        <p>
                            <span t-field="line.name"/>
                        </p>
                    </t>
                    <br/>
                    <span t-field="doc.informacoes_complementares"/>
                </div>
            </div>
            <div class="row" style="border: 1px solid black;padding: 0 0 5px 5px;">
                <div class="col-xs-12" style="text-align:center;">
                    <strong>VALOR TOTAL DA NOTA = </strong>
                    <strong t-field="doc.valor_final" t-field-options="{&quot;widget&quot;: &quot;monetary&quot;,  &quot;display_currency&quot;: &quot;doc.currency_id&quot; }"/>
                    <br/>
                </div>
            </div>
            <div class="row" style="border: 1px solid black; padding:0 0 5px 5px;">
                <div class="col-xs-2" style="width:20%;text-align:center;">
                    INSS(<span/>%):
                    <br/>
                    <t t-if="doc.company_id.fiscal_type == '3'">
                        <strong
                            t-field="doc.eletronic_item_ids[0].inss_value" t-field-options="{&quot;widget&quot;: &quot;monetary&quot;,  &quot;display_currency&quot;: &quot;doc.currency_id&quot; }"/>
                    </t>
                    <t t-if="doc.company_id.fiscal_type != '3'">
                        <strong>-</strong>
                    </t>
                </div>
                <div class="col-xs-2" style="width:20%;text-align:center;">
                    <t t-if="doc.valor_retencao_irrf &lt; 10">
                    IR(0,0%)                        
                    </t>
                    <t t-if="doc.valor_retencao_irrf > 10">
                    IR(<span t-field="doc.eletronic_item_ids[0].ir_percent"/>%):                        
                    </t>
                    <br/>
                    <t t-if="doc.company_id.fiscal_type == '3'">
                        <strong t-field="doc.valor_retencao_irrf" t-field-options="{&quot;widget&quot;: &quot;monetary&quot;,  &quot;display_currency&quot;: &quot;doc.currency_id&quot; }"/>
                    </t>
                    <t t-if="doc.company_id.fiscal_type != '3'">
                        <strong>-</strong>
                    </t>
                </div>
                <div class="col-xs-2"
                        style="width:20%;text-align:center;">
                    CSLL(<span t-field="doc.eletronic_item_ids[0].csll_aliquota"/>%):
                    <br/>
                    <t t-if="doc.company_id.fiscal_type == '3'">
                        <strong t-field="doc.valor_retencao_csll" t-field-options="{&quot;widget&quot;: &quot;monetary&quot;,  &quot;display_currency&quot;: &quot;doc.currency_id&quot; }"/>
                    </t>
                    <t t-if="doc.company_id.fiscal_type != '3'">
                        <strong>-</strong>
                    </t>
                </div>
                <div class="col-xs-2"
                        style="width:20%;text-align:center;">
                    COFINS(<span t-field="doc.eletronic_item_ids[0].cofins_aliquota"/>%):
                    <br/>
                    <t t-if="doc.company_id.fiscal_type == '3'">
                        <strong t-field="doc.valor_retencao_cofins" t-field-options="{&quot;widget&quot;: &quot;monetary&quot;,  &quot;display_currency&quot;: &quot;doc.currency_id&quot; }"/>
                    </t>
                    <t t-if="doc.company_id.fiscal_type != '3'">
                        <strong>-</strong>
                    </t>
                </div>
                <div class="col-xs-2"
                        style="width:20%;text-align:center;border">
                    PIS(<span t-field="doc.eletronic_item_ids[0].pis_aliquota"/>%):
                    <br/>
                    <t t-if="doc.company_id.fiscal_type == '3'">
                        <strong t-field="doc.valor_retencao_pis" t-field-options="{&quot;widget&quot;: &quot;monetary&quot;,  &quot;display_currency&quot;: &quot;doc.currency_id&quot; }"/>
                    </t>
                    <t t-if="doc.company_id.fiscal_type != '3'">
                        <strong>-</strong>
                    </t>
                </div>
            </div>
            <div class="row" style="border: 1px solid black; padding:0 0 5px 5px;">
                <div class="col-xs-12">
                    Código do serviço:
                    <br/>
                    <strong
                        t-field="doc.eletronic_item_ids[0].codigo_servico_paulistana"/> -
                    <strong t-field="doc.eletronic_item_ids[0].product_id.service_type_id.name"/>
                </div>
            </div>
            <div class="row" style="border: 1px solid black;">
                <div class="col-xs-3" style="text-align:center;">
                    VL. Total Deduções (R$):
                    <br/>
                    <strong>R$0,00</strong>
                </div>
                <div class="col-xs-3" style="text-align:center;">
                    Base de Cálculo (R$):
                    <br/>
                    <t t-if="doc.company_id.fiscal_type == '3'">
                        <strong t-field="doc.valor_bruto" t-field-options="{&quot;widget&quot;: &quot;monetary&quot;,  &quot;display_currency&quot;: &quot;doc.currency_id&quot; }"/>
                    </t>
                    <t t-if="doc.company_id.fiscal_type != '3'">
                        <strong>*</strong>
                    </t>
                </div>
                <div class="col-xs-2" style="text-align:center;">
                    Alíquota (%):
                    <br/>
                    <t t-if="doc.company_id.fiscal_type == '3'">
                        <strong>
                            <span t-field="doc.eletronic_item_ids[0].issqn_aliquota"/>%</strong>
                    </t>
                    <t t-if="doc.company_id.fiscal_type != '3'">
                        <strong>*</strong>
                    </t>
                </div>
                <div class="col-xs-2" style="text-align:center;">
                    Valor do ISS (R$):
                    <br/>
                    <t t-if="doc.company_id.fiscal_type == '3'">
                        <strong t-field="doc.valor_issqn" t-field-options="{&quot;widget&quot;: &quot;monetary&quot;,  &quot;display_currency&quot;: &quot;doc.currency_id&quot; }"/>
                    </t>
                    <t t-if="doc.company_id.fiscal_type != '3'">
                        <strong>*</strong>
                    </t>
                </div>
                <div class="col-xs-2" style="text-align:center;">
                    Crédito (R$):
                    <br/>
                    <strong>0,00</strong>
                </div>
            </div>
            <div class="row" style="border: 1px solid black;padding:0 0 5px 5px;">
                <div class="col-xs-4" style="text-align:center;">
                    Município de Prestação do Serviço:
                    <br/>
                    <strong>-</strong>
                </div>
                <div class="col-xs-4" style="text-align:center;">
                    Número Inscrição da Obra:
                    <br/>
                    <strong>-</strong>
                </div>
                <div class="col-xs-4" style="text-align:center;">
                    Valor Aproximado dos Tributos / Fonte
                    <br/>
                    <strong>-</strong>
                </div>
            </div>
            <div class="row" style="border: 1px solid black;min-height:170px; padding:0 0 5px 5px;">
                <div style="text-align:center">
                    <b>Outras informações</b>
                </div>
                <div style="float:left; width:50%;">
                    (1) Esta NFS-e foi emitida com respaldo na Lei nº 14.097/2005;
                </div>
                <div
                        style="float:left; width:50%;">
                    (2) Esta NFS-e substitui o RPS Nº <span
                        t-field="doc.numero"/> Série API, emitido em <span
                        t-field="doc.data_emissao" t-field-options="{&quot;format&quot;: &quot;dd/MM/yyyy&quot;}"/>
                </div>
                <div
                        style="float:left; width:50%;">
                    (3) Data de vencimento do ISS desta NFS-e: <span t-esc="doc.issqn_due_date()"/>
                </div>
                <br/>
                <span t-field="doc.informacoes_legais"/>
            </div>
        </div>
    </template>
    <template id="main_template_br_nfse_danfe">
        <t t-call="report.html_container">
            <t t-as="doc" t-foreach="docs">
                <t t-call="br_nfse.danfse_report_template" t-lang="doc.partner_id.lang"/>
            </t>
        </t>
    </template>
</odoo>

